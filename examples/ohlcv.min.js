var charts=(()=>{var u=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var M=(e,t,i)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var U=(e,t)=>{for(var i in t)u(e,i,{get:t[i],enumerable:!0})},G=(e,t,i,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of w(t))!P.call(e,n)&&n!==i&&u(e,n,{get:()=>t[n],enumerable:!(o=E(t,n))||o.enumerable});return e};var Z=e=>G(u({},"__esModule",{value:!0}),e);var I=(e,t,i)=>M(e,typeof t!="symbol"?t+"":t,i);var K={};U(K,{OHLCV:()=>_,volumeFormatter:()=>y});function b(e,{ratio:t=.2,maxWidth:i=1600,minWidth:o=400,minHeight:n=300}={}){let r=document.querySelector(e),l=d3.min([r.offsetWidth,i]);l=d3.max([r.offsetWidth,o]);let p=d3.max([parseInt(t*l),n]);return[l,p]}function Y(e,t,i,o,n){let r=d3.select("body").append("svg").attr("width",100).attr("height",t).style("visibility","hidden"),l=d3.scaleLinear().domain(i).range([t-e.bottom,e.top]),p=d3.axisLeft(l).tickFormat(o).tickSize(0).ticks(8),h=r.append("g").style("font-size",n.FONT_SIZE).call(p).selectAll(".tick text"),a=0;return h.each(function(){let m=this.getBBox();m.width>a&&(a=m.width)}),a+n.X_TICK_GUTTER+5}var f=class{constructor(t={}){this.ANIMATION_DURATION_MS=500,this.X_TICK_SIZE=4,this.X_TICK_GUTTER=3,this.Y_TICK_SIZE=0,this.Y_TICK_GUTTER=5,this.FONT_SIZE="13px",this.BAND_PADDING=.2,this.VOLUME_OPACITY=.6,this.OHLC_COLORS=["#1ebc8c","#b2b2b2","#f34d27"],this.STROKE_WIDTH=1.5,this.HIGHLIGHT_STROKE_WIDTH=2,this.UNHIGHLIGHTED_OPACITY=.3,this.DOT_RADIUS=3,Object.assign(this,t)}};var x=class{constructor(t,i={}){I(this,"tickFormatX",null);I(this,"tickFormatY",null);this.options=new f(i),this.data=t,this.parse(t)}getMargin(t,i){return margin={top:15,right:15,bottom:25,left:45}}parse(t){this.X=this.parseX(t),this.Y=this.parseY(t),this.Z=this.parseZ(t),this.items=new Set(this.Z);let i=(o,n)=>!isNaN(this.X[n])&&!isNaN(this.Y[n]);this.D=d3.map(t,i),this.I=d3.range(this.X.length),this.grouping=d3.group(this.I,o=>this.Z[o]),this.setColors(t)}formatX(t){return t}formatY(t){return t}formatZ(t){return t}parseX(t){return d3.map(t,i=>d3.isoParse(i[0]))}parseY(t){return d3.map(t,i=>i[1])}parseZ(t){return d3.map(t,i=>i[2])}getDomainX(){return d3.extent(this.X)}getRangeX(t,i){return[i.left,t.width-i.right]}getDomainY(){return d3.extent(this.Y)}getRangeY(t,i){return[t.height-i.bottom,i.top]}setColors(t){this.colors=d3.scaleOrdinal().domain(this.items).range(d3.schemeCategory10)}getColor(t){return this.colors(t)}createSVG(t,i){d3.select(t).selectAll("svg").remove(),this.svg=d3.select(t).append("svg").attr("viewBox",[0,0,i.width,i.height]).attr("style","max-width: 100%; height: intrinsic;").style("-webkit-tap-highlight-color","transparent").style("font-size",this.options.FONT_SIZE).style("overflow","visible")}};var J=d3.utcFormat("%b"),L=d3.utcFormat("%b %-d"),Q=d3.utcFormat("%b %Y"),H=d3.utcFormat("%b %-d, %Y"),tt=d3.utcFormat("%B %-d, %Y");function k(){let e=null;return function(t){let i=t.getUTCFullYear();return e!==i?(e=i,H(t)):L(t)}}function v(e,t){var i=!0;return function(){i&&(e.apply(this,arguments),i=!1,setTimeout(()=>{i=!0},t))}}function y(e){return e<=0?"":e>=1e9?`${e/1e9}B`:`${e/1e6}M`}var _=class extends x{parse(t){this.X=d3.map(t,i=>d3.isoParse(i[0])),this.Yo=d3.map(t,i=>i[1]),this.Yh=d3.map(t,i=>i[2]),this.Yl=d3.map(t,i=>i[3]),this.Yc=d3.map(t,i=>i[4]),this.Yv=d3.map(t,i=>i[5]),this.I=d3.range(this.X.length)}getMargin(t,i){let o={top:15,right:25,bottom:25,left:40};return o.left=Y(o,i,this.getDomainY(),this.tickFormatY,this.options),o.right=Y(o,i,this.yDomainVolume,y,this.options),o}getDomainX(){return d3.extent(this.X)}getDomainY(){this.minPrice=d3.min(this.Yl);let t=d3.max(this.Yh);return this.yDomain=[this.minPrice,t+(t-this.minPrice)*.05],this.yDomainVolume=[0,d3.max(this.Yv)],this.yDomain}getColor(t){return this.options.OHLC_COLORS[1+Math.sign(this.Yo[t]-this.Yc[t])]}render(t){let[i,o]=b(t,{ratio:.35}),n={width:i,height:o},r=this.getMargin(i,o),l=o-r.top-r.bottom;this.chartHeight=l;let d=l*.9,h=[r.top+d,r.top],a=[r.top+l,r.top+d],m=",f",D="",T=parseInt(this.X.length/10);T<1&&(T=1);let C=d3.filter(this.X,(s,R)=>R%T===0);this.xScale=d3.scaleBand(this.X,this.getRangeX(n,r)).padding(this.options.BAND_PADDING).align(.1);let c=d3.scaleLinear(this.getDomainY(),h),g=d3.scaleLinear(this.yDomainVolume,a),O=k(),A=d3.axisBottom(this.xScale).tickFormat(O).tickValues(C).tickSize(this.options.X_TICK_SIZE);this.bandWidth=this.xScale.step();let N=d3.axisLeft(c).ticks(d/40,m).tickSize(this.options.Y_TICK_SIZE),X=d3.axisRight(g).ticks(1).tickFormat(y).tickSize(3);this.createSVG(t,n);let F=this.bandWidth*this.options.BAND_PADDING/2;this.svg.append("g").style("font-size",this.options.FONT_SIZE).attr("transform",`translate(${F},${o-r.bottom+this.options.X_TICK_GUTTER})`).call(A).call(s=>s.select(".domain").remove()),this.svg.append("g").style("font-size",this.options.FONT_SIZE).attr("transform",`translate(${r.left-this.options.Y_TICK_GUTTER},0)`).call(N).call(s=>s.select(".domain").remove()).call(s=>s.selectAll(".tick line").clone().attr("stroke","#bbb").attr("stroke-opacity",.5).attr("x1",this.options.Y_TICK_GUTTER).attr("x2",i+this.options.Y_TICK_GUTTER-r.left-r.right)).call(s=>s.append("text").attr("x",-r.left).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text(D)),this.svg.append("g").style("font-size",this.options.FONT_SIZE).attr("transform",`translate(${i-r.right},0)`).call(X).call(s=>s.select(".domain").remove()).call(s=>s.append("text").attr("x",-r.left).attr("fill","currentColor").attr("text-anchor","start").text(D));let S=this.svg.append("g").attr("stroke","currentColor").attr("stroke-linecap","butt").selectAll("g").data(this.I).join("g").attr("transform",s=>`translate(${this.xScale(this.X[s])+this.bandWidth/2},0)`);S.append("line").attr("stroke","currentColor").attr("stroke-width",1).attr("opacity",.8).attr("y1",c(this.minPrice)).attr("y2",c(this.minPrice)).transition().duration(this.options.ANIMATION_DURATION_MS).attr("y1",s=>c(this.Yl[s])).attr("y2",s=>c(this.Yh[s])),S.append("line").attr("stroke-width",this.xScale.bandwidth()).attr("stroke",s=>this.getColor(s)).attr("y1",c(this.minPrice)).attr("y2",c(this.minPrice)).transition().duration(this.options.ANIMATION_DURATION_MS).attr("y1",s=>c(this.Yo[s])).attr("y2",s=>c(this.Yc[s])),this.svg.append("g").attr("stroke","currentColor").attr("stroke-linecap","butt").selectAll("g").data(this.I).join("g").attr("transform",s=>`translate(${this.xScale(this.X[s])+this.bandWidth/2},0)`).append("line").attr("y1",g(0)).attr("y2",g(0)).attr("stroke-width",this.xScale.bandwidth()).attr("stroke",s=>this.getColor(s)).style("opacity",this.options.VOLUME_OPACITY).transition().duration(this.options.ANIMATION_DURATION_MS).attr("y2",s=>g(this.Yv[s]))}enableHover(t,i){let o=d3.map(this.X,p=>[this.xScale(p)+this.bandWidth/2,1]),n=d3.Delaunay.from(o),r=null,l=p=>{let[d]=d3.pointer(p),h=n.find(d,1);if(r&&r==h)return;r=h;let a={x:this.X[h],o:this.Yo[h],h:this.Yh[h],l:this.Yl[h],c:this.Yc[h],v:this.Yv[h]};h>0&&(a.prev=this.Yc[h-1],a.prev&&(a.delta=a.c-a.prev,a.percent=a.delta/a.prev,a.color=this.options.OHLC_COLORS[1+Math.sign(-a.delta)])),t&&t.call(this,a)};this.svg.on("pointermove",v(l,20)),i&&this.svg.on("pointerleave",i)}};return Z(K);})();
//# sourceMappingURL=ohlcv.min.js.map
