var charts=(()=>{var x=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var E=(s,t)=>{for(var e in t)x(s,e,{get:t[e],enumerable:!0})},w=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of P(t))!R.call(s,o)&&o!==e&&x(s,o,{get:()=>t[o],enumerable:!(n=F(t,o))||n.enumerable});return s};var M=s=>w(x({},"__esModule",{value:!0}),s);var G={};E(G,{OHLCV:()=>Y,volumeFormatter:()=>b});function T(s,{ratio:t=.2,maxWidth:e=1600,minWidth:n=400,minHeight:o=300}={}){let r=document.querySelector(s),l=d3.min([r.offsetWidth,e]);l=d3.max([r.offsetWidth,n]);let p=d3.max([parseInt(t*l),o]);return[l,p]}var u=class{constructor(t={}){this.ANIMATION_DURATION_MS=500,this.X_TICK_SIZE=4,this.X_TICK_GUTTER=3,this.Y_TICK_SIZE=0,this.Y_TICK_GUTTER=5,this.BAND_PADDING=.2,this.VOLUME_OPACITY=.6,this.OHLC_COLORS=["#1ebc8c","#b2b2b2","#f34d27"],this.FONT_SIZE="13px",Object.assign(this,t)}};var g=class{constructor(t,e={}){this.options=new u(e),this.parse(t)}parse(t){this.X=this.parseX(t),this.Y=this.parseY(t),this.Z=this.parseZ(t);let e=(n,o)=>!isNaN(this.X[o])&&!isNaN(this.Y[o]);this.D=d3.map(t.values,e),this.I=d3.range(this.X.length),this.grouping=d3.group(this.I,n=>this.Z[n]),this.setColors(t)}parseX(t){return d3.map(t.values,e=>d3.isoParse(e[0]))}parseY(t){return d3.map(t.values,e=>e[1])}parseZ(t){return d3.map(t.values,e=>e[2])}getDomainX(){return d3.extent(this.X)}getRangeX(t,e){return[e.left,t.width-e.right]}getDomainY(){return d3.extent(this.Y)}getRangeY(t,e){return[t.height-e.bottom,e.top]}setColors(t){let e=t.z.reduce((n,o)=>(n[o.name]=o.color,n),{});this.colors=d3.scaleOrdinal().domain(Object.keys(e)).range(Object.values(e))}getColor(t){return this.colors(t)}createSVG(t,e){d3.select(t).selectAll("svg").remove(),this.svg=d3.select(t).append("svg").attr("viewBox",[0,0,e.width,e.height]).attr("style","max-width: 100%; height: intrinsic;").style("-webkit-tap-highlight-color","transparent").style("font-size",this.options.FONT_SIZE).style("overflow","visible")}};var W=d3.utcFormat("%b"),U=d3.utcFormat("%b %-d"),H=d3.utcFormat("%b %Y"),Z=d3.utcFormat("%b %-d, %Y"),j=d3.utcFormat("%B %-d, %Y");function _(){let s=null;return function(t){let e=t.getUTCFullYear();return s!==e?(s=e,Z(t)):U(t)}}function v(s,t){var e=!0;return function(){e&&(s.apply(this,arguments),e=!1,setTimeout(()=>{e=!0},t))}}function b(s){return s<=0?"":s>=1e9?`${s/1e9}B`:`${s/1e6}M`}var Y=class extends g{parse(t){this.X=d3.map(t,e=>d3.isoParse(e[0])),this.Yo=d3.map(t,e=>e[1]),this.Yh=d3.map(t,e=>e[2]),this.Yl=d3.map(t,e=>e[3]),this.Yc=d3.map(t,e=>e[4]),this.Yv=d3.map(t,e=>e[5]),this.I=d3.range(this.X.length)}getDomainX(){return d3.extent(this.X)}getDomainY(){this.minPrice=d3.min(this.Yl);let t=d3.max(this.Yh);return this.yDomain=[this.minPrice,t+(t-this.minPrice)*.05],this.yDomainVolume=[0,d3.max(this.Yv)],this.yDomain}getColor(t){return this.options.OHLC_COLORS[1+Math.sign(this.Yo[t]-this.Yc[t])]}render(t){let[e,n]=T(t,{ratio:.35}),o={width:e,height:n},r={top:15,right:25,bottom:25,left:40},l=n-r.top-r.bottom;this.chartHeight=l;let d=l*.9,a=[r.top+d,r.top],h=[r.top+l,r.top+d],S=",f",y="",f=parseInt(this.X.length/10);f<1&&(f=1);let D=d3.filter(this.X,(i,X)=>X%f===0);this.xScale=d3.scaleBand(this.X,this.getRangeX(o,r)).padding(this.options.BAND_PADDING).align(.1);let c=d3.scaleLinear(this.getDomainY(),a),m=d3.scaleLinear(this.yDomainVolume,h),C=_(),k=d3.axisBottom(this.xScale).tickFormat(C).tickValues(D).tickSize(this.options.X_TICK_SIZE);this.bandWidth=this.xScale.step();let A=d3.axisLeft(c).ticks(d/40,S).tickSize(this.options.Y_TICK_SIZE),N=d3.axisRight(m).ticks(2).tickFormat(b).tickSize(3);this.createSVG(t,o);let O=this.bandWidth*this.options.BAND_PADDING/2;this.svg.append("g").style("font-size",this.options.FONT_SIZE).attr("transform",`translate(${O},${n-r.bottom+this.options.X_TICK_GUTTER})`).call(k).call(i=>i.select(".domain").remove()),this.svg.append("g").style("font-size",this.options.FONT_SIZE).attr("transform",`translate(${r.left-this.options.Y_TICK_GUTTER},0)`).call(A).call(i=>i.select(".domain").remove()).call(i=>i.selectAll(".tick line").clone().attr("stroke","#bbb").attr("stroke-opacity",.5).attr("x1",this.options.Y_TICK_GUTTER).attr("x2",e+this.options.Y_TICK_GUTTER-r.left-r.right)).call(i=>i.append("text").attr("x",-r.left).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text(y)),this.svg.append("g").style("font-size",this.options.FONT_SIZE).attr("transform",`translate(${e-r.right},0)`).call(N).call(i=>i.select(".domain").remove()).call(i=>i.append("text").attr("x",-r.left).attr("fill","currentColor").attr("text-anchor","start").text(y));let I=this.svg.append("g").attr("stroke","currentColor").attr("stroke-linecap","butt").selectAll("g").data(this.I).join("g").attr("transform",i=>`translate(${this.xScale(this.X[i])+this.bandWidth/2},0)`);I.append("line").attr("stroke","currentColor").attr("stroke-width",1).attr("opacity",.8).attr("y1",c(this.minPrice)).attr("y2",c(this.minPrice)).transition().duration(this.options.ANIMATION_DURATION_MS).attr("y1",i=>c(this.Yl[i])).attr("y2",i=>c(this.Yh[i])),I.append("line").attr("stroke-width",this.xScale.bandwidth()).attr("stroke",i=>this.getColor(i)).attr("y1",c(this.minPrice)).attr("y2",c(this.minPrice)).transition().duration(this.options.ANIMATION_DURATION_MS).attr("y1",i=>c(this.Yo[i])).attr("y2",i=>c(this.Yc[i])),this.svg.append("g").attr("stroke","currentColor").attr("stroke-linecap","butt").selectAll("g").data(this.I).join("g").attr("transform",i=>`translate(${this.xScale(this.X[i])+this.bandWidth/2},0)`).append("line").attr("y1",m(0)).attr("y2",m(0)).attr("stroke-width",this.xScale.bandwidth()).attr("stroke",i=>this.getColor(i)).style("opacity",this.options.VOLUME_OPACITY).transition().duration(this.options.ANIMATION_DURATION_MS).attr("y2",i=>m(this.Yv[i]))}enableHover(t,e){let n=d3.map(this.X,p=>[this.xScale(p)+this.bandWidth/2,1]),o=d3.Delaunay.from(n),r=null,l=p=>{let[d]=d3.pointer(p),a=o.find(d,1);if(r&&r==a)return;r=a;let h={x:this.X[a],o:this.Yo[a],h:this.Yh[a],l:this.Yl[a],c:this.Yc[a],v:this.Yv[a]};a>0&&(h.prev=this.Yc[a-1],h.prev&&(h.delta=h.c-h.prev,h.percent=h.delta/h.prev)),t&&t.call(this,h)};this.svg.on("pointermove",v(l,20)),e&&this.svg.on("pointerleave",e)}};return M(G);})();
//# sourceMappingURL=ohlcv.min.js.map
